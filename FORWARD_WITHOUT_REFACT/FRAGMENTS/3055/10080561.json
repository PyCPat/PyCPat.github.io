{"BEFORE":"            dots.masked_fill_(~mask, float('-inf'))\n","AFTER":"        dots = einsum('b h i d, b h j d -> b h i j', q, k) * scale\n\n        if exists(mask):\n            mask_value = -torch.finfo(dots.dtype).max\n            mask = rearrange(mask, 'b n -> b () () n')\n            dots.masked_fill_(~mask, mask_value)\n"}