{"BEFORE":"        loss = F.binary_cross_entropy_with_logits(pred, target, reduction='none') * focal_weight\n        if reduction == 'sum':\n            return loss.sum()\n        elif reduction == 'mean':\n            return loss.mean()\n","AFTER":"        target = target.type_as(pred)\n        pt = (1 - pred_sigmoid) * target + pred_sigmoid * (1 - target)\n        focal_weight = (self.alpha * target + (1 - self.alpha) * (1 - target)) * pt.pow(self.gamma)\n        loss = F.binary_cross_entropy_with_logits(pred, target, reduction='none') * focal_weight\n        if reduction == 'sum':\n            return loss.sum()\n        elif reduction == 'mean':\n            return loss.sum() \/ (target==1.0).float().sum()\n"}