<link rel="stylesheet" href="../default.css">
<script src="../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        &#47&#47 \end{align}
        &#47&#47
        &#47&#47 for $i \in {1, 2, ..., \frac{d}{2}}$
        rx = (x * <a id="change">idx_theta2.cos()[:, None, None, :]</a>) + (neg_half_x * <a id="change">idx_theta2.sin()[:, None, None, :]</a>)

        &#47&#47
        return rx</code></pre><h3>After Change</h3><pre><code class='java'>
        x_rope = (x_rope * self.cos_cached[:x.shape[0]]) + (neg_half_x * self.sin_cached[:x.shape[0]])

        &#47&#47
        <a id="change">return </a>torch.cat((x_rope<a id="change">, x_pass</a>), dim=-1)


class RotaryPEMultiHeadAttention(MultiHeadAttention):</code></pre>