{"BEFORE":"        seq_length = seg.size(1)\n        device = seg.device\n        emb = self.pe[: seq_length].transpose(0, 1)\n","AFTER":"        if seg is not None:\n            batch_size, seq_length = seg.size()\n            device = seg.device\n            no_pad_num = seg.sum(dim=-1)\n        else:\n            batch_size, seq_length = src.size()\n            device = src.device\n            no_pad_num = (src != 0).sum(dim=-1)\n        \n        emb =  torch.zeros(batch_size, seq_length, self.emb_size)\n        for i in range(batch_size):\n            emb[i, :no_pad_num[i], :] = self.emb[2: no_pad_num[i]+2]\n\n        return emb.to(device)\n"}