{"BEFORE":"        inter = (codebook ** 2).sum(-1)\n        # [k, k]\n        intra = codebook @ codebook.T\n\n        distance = 2 * ((inter[:, None] - 2 * intra + inter) \/ codebook.shape[-1]).triu(1)\n\n        lower = F.relu(self._lower - distance) ** 2\n\n        upper = F.relu(distance - self._upper) ** 2\n\n        return (lower + upper).mean()\n","AFTER":"        inter = (codebook ** 2).sum(-1)\n        # [k, k]\n        intra = (codebook @ codebook.T).triu(1)\n\n        loss = ((inter - 1.0) ** 2).mean() - intra.mean()\n\n        return loss\n"}