{"BEFORE":"        patches = self.proj(x)  # BCHW\n\n        B, C, H, W = patches.size()\n        patches = patches.view(B, C, -1).permute(0, 2, 1)  # (batch_size, num_patches, d_model)\n","AFTER":"        x = x.reshape(\n            B, C, (H \/\/ self.patch_size[0]), self.patch_size[0], (W \/\/ self.patch_size[1]), self.patch_size[1]\n        )\n        # (B, H', W', C, ph, pw) -> (B, H'*W', C*ph*pw)\n        patches = x.permute(0, 2, 4, 1, 3, 5).flatten(1, 2).flatten(2, 4)\n        patches = self.proj(patches)  # (batch_size, num_patches, d_model)\n"}