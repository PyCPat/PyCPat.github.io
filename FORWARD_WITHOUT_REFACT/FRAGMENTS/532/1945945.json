{"BEFORE":"        for (layer_type, block) in zip(self.layer_types, self.layers):\n            if layer_type == 'a':\n                x = block(x, mask = mask, rel_pos = self.rel_pos) + x\n            elif layer_type == 'c':\n                x = block(x, context = context, mask = mask, context_mask = context_mask) + x\n            elif layer_type == 'f':\n                x = block(x) + x\n        return x\n","AFTER":"        prev_attn = None\n        for (layer_type, (norm, block)) in zip(self.layer_types, self.layers):\n            if self.pre_norm:\n                x = norm(x)\n\n            if layer_type == 'a':\n                attn_out, pre_attn = block(x, mask = mask, rel_pos = self.rel_pos, prev_attn = prev_attn)\n                x = x + attn_out\n            elif layer_type == 'c':\n                attn_out, pre_attn = block(x, context = context, mask = mask, context_mask = context_mask, prev_attn = prev_attn) + x\n                x = x + attn_out\n            elif layer_type == 'f':\n                x = block(x) + x\n\n            if isinstance(block, Attention) and self.residual_attn:\n                prev_attn = pre_attn\n\n            if not self.pre_norm:\n                x = norm(x)\n\n        return x\n"}