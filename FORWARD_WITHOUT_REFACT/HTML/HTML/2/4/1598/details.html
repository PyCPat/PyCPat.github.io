<html><h3>Pattern ID :1598
</h3><img src='6501671.png'><BR><BR><BR><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        has_local, has_global = map(lambda x: x.shape[1] &gt; 0, (lqk, qk))

        out = []
        total_loss = <a id="change">torch.tensor(0.</a><a id="change">, **to(x))</a>

        if has_local:
            local_out = self.local_attn(lqk, lqk, lv, input_mask = input_mask)
            out.append(local_out)</code></pre><h3>After Change</h3><pre><code class='java'>
        has_local, has_global = map(lambda x: x.shape[1] &gt; 0, (lqk, qk))

        out = []
        total_loss = <a id="change">torch.tensor(0.</a><a id="change">, **to(x))</a>.requires_grad_()

        if has_local:
            local_out = self.local_attn(lqk, lqk, lv, input_mask = input_mask)</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 2</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/lucidrains/routing-transformer/commit/34244958ff1c434606481afbe14c63d7d3a7d60c#diff-1a96ccaa437a86e24c768ea078dd19db87f8694dae807ecbb231a703aba4702dL494' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6501671</div><div id='project'> Project Name: lucidrains/routing-transformer</div><div id='commit'> Commit Name: 34244958ff1c434606481afbe14c63d7d3a7d60c</div><div id='time'> Time: 2020-05-25</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: routing_transformer/routing_transformer.py</div><div id='m_class'> M Class Name: SelfAttention</div><div id='n_method'> N Class Name: SelfAttention</div><div id='m_method'> M Method Name: forward(3)</div><div id='n_method'> N Method Name: forward(3)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: routing_transformer/routing_transformer.py</div><div id='n_file'> N File Name: routing_transformer/routing_transformer.py</div><div id='m_start'> M Start Line: 494</div><div id='m_end'> M End Line: 508</div><div id='n_start'> N Start Line: 494</div><div id='n_end'> N End Line: 508</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
            has_local, has_global = False, True

        out = []
        total_loss = <a id="change">torch.tensor(0.</a><a id="change">, **to(x))</a>.requires_grad_()

        if has_local:
            local_out = self.local_attn(lqk, lqk, lv, input_mask = input_mask)</code></pre><h3>After Change</h3><pre><code class='java'>
            has_local, has_global = False, True

        out = []
        total_loss = <a id="change">torch.tensor(0.</a><a id="change">, requires_grad=True, **to(x))</a>

        if has_local:
            local_out = self.local_attn(lqk, lqk, lv, input_mask = input_mask)
            out.append(local_out)</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/lucidrains/routing-transformer/commit/2042adb06111339b86814500f0c389759b8f6cdf#diff-1a96ccaa437a86e24c768ea078dd19db87f8694dae807ecbb231a703aba4702dL560' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6501668</div><div id='project'> Project Name: lucidrains/routing-transformer</div><div id='commit'> Commit Name: 2042adb06111339b86814500f0c389759b8f6cdf</div><div id='time'> Time: 2020-05-27</div><div id='author'> Author: lucidrains@gmail.com</div><div id='file'> File Name: routing_transformer/routing_transformer.py</div><div id='m_class'> M Class Name: SelfAttention</div><div id='n_method'> N Class Name: SelfAttention</div><div id='m_method'> M Method Name: forward(5)</div><div id='n_method'> N Method Name: forward(5)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: routing_transformer/routing_transformer.py</div><div id='n_file'> N File Name: routing_transformer/routing_transformer.py</div><div id='m_start'> M Start Line: 582</div><div id='m_end'> M End Line: 596</div><div id='n_start'> N Start Line: 556</div><div id='n_end'> N End Line: 556</div><BR>'><BR><BR><BR><h3>Before Change</h3><pre><code class='java'>
                labels = torch.zeros_like(classification, device=device)
                class_loss_total.append(weighted_binary_focal_loss(
                    classification, labels, self.alpha, self.gamma, reduction=&quotsum&quot))
                reg_loss_total.append(<a id="change">torch.tensor(0.</a><a id="change">)</a>)
                continue
            &#47&#47 ---------------------------------------- class_loss
            iou, matched = box_iou(anchors, boxes_ori).max(dim=1)  &#47&#47 每个anchors只能对应一个boxes</code></pre><h3>After Change</h3><pre><code class='java'>
                labels = torch.zeros_like(classification, device=device)
                class_loss_total.append(weighted_binary_focal_loss(
                    classification, labels, self.alpha, self.gamma, reduction=&quotsum&quot))
                reg_loss_total.append(<a id="change">torch.tensor(0.</a><a id="change">)</a>.to(device))
                continue
            &#47&#47 ---------------------------------------- class_loss
            iou, matched = box_iou(anchors, boxes_ori).max(dim=1)  &#47&#47 每个anchors只能对应一个boxes</code></pre>'><BR><BR><BR><BR><div id='link'><a href='https://github.com/jintao-huang/efficientdet_pytorch/commit/f8166ea480c202b787c7d131e35e5f5db61dfdf8#diff-4c422858fce93337b79d5c0e8f87c16b917c07d87986359aef07294446b24b38L56' target='_blank'>Link</a></div><div id='fragmentid'> Fragment ID: 6501672</div><div id='project'> Project Name: jintao-huang/efficientdet_pytorch</div><div id='commit'> Commit Name: f8166ea480c202b787c7d131e35e5f5db61dfdf8</div><div id='time'> Time: 2020-05-24</div><div id='author'> Author: hjt_study@qq.com</div><div id='file'> File Name: models/loss.py</div><div id='m_class'> M Class Name: FocalLoss</div><div id='n_method'> N Class Name: FocalLoss</div><div id='m_method'> M Method Name: forward(5)</div><div id='n_method'> N Method Name: forward(5)</div><div id='m_parent_class'> M Parent Class: nn.Module</div><div id='n_parent_class'> N Parent Class: nn.Module</div><div id='m_file'> M File Name: models/loss.py</div><div id='n_file'> N File Name: models/loss.py</div><div id='m_start'> M Start Line: 77</div><div id='m_end'> M End Line: 92</div><div id='n_start'> N Start Line: 67</div><div id='n_end'> N End Line: 95</div><BR>