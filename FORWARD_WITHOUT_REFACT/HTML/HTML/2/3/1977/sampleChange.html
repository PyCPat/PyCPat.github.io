<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        if padding_mask is not None:
            x = x * (1.0 - padding_mask.unsqueeze(1).type_as(x))

        <a id="change">assert </a>not self.bidirectional or state is None, &quotBidirectional EMA does not support incremental state&quot
        if state is not None:
            saved_state = self._get_input_buffer(state)
            if &quotprev_state&quot in saved_state:</code></pre><h3>After Change</h3><pre><code class='java'>
            u_f = torch.fft.rfft(u_.float(), n=2 * l_fft)
            y = torch.fft.irfft(u_f * k_f, n=2 * l_fft)[..., s:s + L]  &#47&#47 (B H L)
            y = y.type_as(u)
            y = y + u * <a id="change">self.omega.unsqueeze(-1</a><a id="change">)</a>  &#47&#47 (B H L)
            y = y.transpose(-1, -2)

        return y, None  &#47&#47 empty state</code></pre>