{"BEFORE":"        return x\n","AFTER":"        b, c, x, y, h, c_out = *img.shape, self.heads, self.dim_out\n\n        qkv = self.to_qkv(img).chunk(3, dim = 1)\n        q, k, v = map(lambda t: rearrange(t, 'b (h c) x y -> b h c (x y)', h = h), qkv)\n\n        k = k.softmax(dim = -1)\n        context = einsum('bhdn,bhen->bhde', k, v)\n\n        content_out = einsum('bhde,bhdn->bhen', context, q)\n        content_out = content_out.reshape(b, -1, x, y)\n        content_out = self.to_out(content_out)\n\n        # todo: compute relative position attentions and sum to content_out\n\n        return content_out\n"}