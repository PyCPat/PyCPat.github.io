{"BEFORE":"        discretized_target = rearrange(discretized_target,\n                                       \"b n c bi -> b n (c bi)\",\n                                       c=c,\n                                       bi=bi)\n\n        predicted_patches = predicted_patches[mask]\n        discretized_target = discretized_target[mask]\n        loss = F.mse_loss(predicted_patches, discretized_target)\n","AFTER":"        discretized_target = rearrange(discretized_target,\n                                       \"b n c bi -> b n (c bi)\",\n                                       c=c,\n                                       bi=bi)\n\n        bin_mask = 2**torch.arange(c * bi - 1, -1,\n                                   -1).to(discretized_target.device,\n                                          discretized_target.dtype)\n        target_label = torch.sum(bin_mask * discretized_target, -1)\n\n        predicted_patches = predicted_patches[mask]\n        target_label = target_label[mask]\n        loss = F.cross_entropy(predicted_patches, target_label)\n"}