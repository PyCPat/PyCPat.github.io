{"BEFORE":"        x_ = x.contiguous().view(b, h * w, c).repeat(1, 1, self.heads)\r\n        x_ = x_.contiguous().view(b, self.heads, h * w, c)\r\n        q = x_\r\n        # b h m c\r\n        k = self.to_k(z).view(b, self.heads, m, c)\r\n        v = self.to_v(z).view(b, self.heads, m, c)\r\n        # b h l m\r\n        dots = einsum('b h l c, b h m c -> b h l m', q, k) * self.scale\r\n        # b h l m\r\n        attn = self.attend(dots)\r\n        out = einsum('b h l m, b h m c -> b h l c', attn, v)\r\n","AFTER":"        q = x.contiguous().view(b, h * w, c).unsqueeze(1)\r\n        k = self.to_k(z).view(b, self.heads, m, c)\r\n        v = self.to_v(z).view(b, self.heads, m, c)\r\n        dots = q @ k.transpose(2, 3) * self.scale\r\n        attn = self.attend(dots)\r\n        out = attn @ v\r\n"}