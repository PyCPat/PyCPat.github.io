{"BEFORE":"        p = p[torch.arange(p.shape[0]), target]\n\n        # Adapt formula as p is in log-scale\n        loss = torch.where(\n            p <= math.log(1 \/ self.tau),\n            -self.tau * torch.exp(p) + math.log(self.tau) + 1,\n            -p,\n        )\n","AFTER":"        p = p[torch.arange(p.shape[0]), target]\n\n        loss = torch.empty_like(p)\n        clip = (p <= 1 \/ self.tau)\n        loss[clip] = -self.tau * p[clip] + math.log(self.tau) + 1\n        loss[~clip] = -torch.log(p[~clip])\n"}