{"BEFORE":"        product = positions * self.freq\n\n        pos_emb = torch.zeros(batch_size, n_tokens, n_feats, device=x.device)\n        pos_emb[:, :, 0::2] = torch.sin(product)\n        pos_emb[:, :, 1::2] = torch.cos(product)\n","AFTER":"        product = positions * self.freq.to(x)\n\n        pos_emb = torch.sin(product + self.cos_shifts.to(x))\n"}