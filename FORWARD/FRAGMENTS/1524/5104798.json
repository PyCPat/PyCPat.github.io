{"BEFORE":"        m = m + self.msa_transition(\n            m, mask=msa_trans_mask, chunk_size=chunk_size,\n        )\n        z = z + self.outer_product_mean(\n            m, mask=msa_mask, chunk_size=chunk_size,\n        )\n        z = z + self.ps_dropout_row_layer(self.tri_mul_out(z, mask=pair_mask))\n        z = z + self.ps_dropout_row_layer(self.tri_mul_in(z, mask=pair_mask))\n        z = z + self.ps_dropout_row_layer(\n            self.tri_att_start(\n                z, \n                mask=pair_mask, \n                chunk_size=chunk_size, \n                use_lma=use_lma\n            )\n        )\n        z = z + self.ps_dropout_col_layer(\n            self.tri_att_end(\n                z, \n                mask=pair_mask, \n                chunk_size=chunk_size,\n                use_lma=use_lma,\n            )\n        )\n        z = z + self.pair_transition(\n            z, mask=pair_trans_mask, chunk_size=chunk_size,\n        )\n","AFTER":"        inplace_safe = not (self.training or torch.is_grad_enabled())\n\n        m = add(\n            m,\n            self.msa_transition(\n                m, mask=msa_trans_mask, chunk_size=chunk_size,\n            ),\n            inplace=inplace_safe,\n        )\n        z = add(z, \n            self.outer_product_mean(\n                m, mask=msa_mask, chunk_size=chunk_size, _inplace=inplace_safe\n            ),\n            inplace=inplace_safe,\n        )\n\n        tmu_update = self.tri_mul_out(\n            z,\n            mask=pair_mask,\n            _inplace=inplace_safe,\n            _add_with_inplace=True,\n        )\n        if(not inplace_safe):\n            z = z + self.ps_dropout_row_layer(tmu_update)\n        else:\n            z = tmu_update\n        \n        del tmu_update\n\n        tmu_update = self.tri_mul_in(\n            z,\n            mask=pair_mask,\n            _inplace=inplace_safe,\n            _add_with_inplace=True,\n        )\n        if(not inplace_safe):\n            z = z + self.ps_dropout_row_layer(tmu_update)\n        else:\n            z = tmu_update\n       \n        del tmu_update\n\n        z = add(z, \n            self.ps_dropout_row_layer(\n                self.tri_att_start(\n                    z, \n                    mask=pair_mask, \n                    chunk_size=chunk_size, \n                    use_lma=use_lma\n                )\n            ),\n            inplace=inplace_safe,\n        )\n        z = add(z, \n            self.ps_dropout_col_layer(\n                self.tri_att_end(\n                    z, \n                    mask=pair_mask, \n                    chunk_size=chunk_size,\n                    use_lma=use_lma,\n                )\n            ),\n            inplace=inplace_safe,\n        )\n        z = add(z,\n            self.pair_transition(\n                z, mask=pair_trans_mask, chunk_size=chunk_size,\n            ),\n            inplace=inplace_safe,\n        )\n"}