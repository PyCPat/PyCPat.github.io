{"BEFORE":"        return x\n","AFTER":"        mask = None\n    ):\n        n, device = x.shape[1], x.device\n        x = self.token_emb(x)\n        pos_emb = self.pos_emb(torch.arange(n, device = device))\n        x = x + rearrange(pos_emb, 'n d -> () n d')\n\n        for attn, ff in self.layers:\n            x = attn(x, mask = mask) + x\n            x = ff(x) + x\n\n        return self.to_logits(x)\n"}