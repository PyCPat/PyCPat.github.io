{"BEFORE":"        x = x.transpose(0, 1)\n        kv = torch.cat((x, self.mem_kv.expand(m, b, e)))\n\n        attn_shape = (t, t + m)\n","AFTER":"    def forward(self, x, keys = None):\n        device = x.device\n        b, t, e, m = *x.shape, self.num_mem_kv\n\n        mem = self.mem_kv.expand(m, b, e)\n        keys = default(keys, torch.empty(b, 0, e, device=device))\n\n        x, keys = x.transpose(0, 1), keys.transpose(0, 1)\n\n        kv = torch.cat((x, mem, keys))\n\n        kv_len = t + m + keys.shape[0]\n        attn_shape = (t, kv_len)\n"}