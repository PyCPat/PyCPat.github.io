{"BEFORE":"        prediction,target = prediction.unsqueeze(1),target.unsqueeze(1)\n","AFTER":"        target_energy = torch.sum(target**2,keepdim=True,dim=-1)\n        scaling_factor = torch.sum(prediction*target,keepdim=True,dim=-1) \/ target_energy\n        target_projection = target * scaling_factor\n        noise = prediction - target_projection\n        ratio = torch.sum(target_projection**2,dim=-1) \/ torch.sum(noise**2,dim=-1)\n        si_sdr = 10*torch.log10(ratio).mean(dim=-1)\n\n        if self.reduction == \"sum\":\n            si_sdr = si_sdr.sum()\n        elif self.reduction == \"mean\":\n            si_sdr = si_sdr.mean()\n        else:\n            pass\n    \n        return si_sdr\n"}