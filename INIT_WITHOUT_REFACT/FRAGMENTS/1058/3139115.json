{"BEFORE":"        return self._codebook[ix, codes].reshape(n, h, w, -1).permute(0, 3, 1, 2)\n","AFTER":"        indexed = self._codebook[ix, codes]\n        indexed = torch.einsum(\"nhwmd,mcd->nhwmc\", indexed, self._wq) + self._bq\n        return indexed.reshape(n, h, w, -1).permute(0, 3, 1, 2)\n"}