{"BEFORE":"        q, k, v = self.QKV(x).chunk(3, dim=-1)\n","AFTER":"        if isinstance(x, tuple):\n            b, n, d, h = *x[0].shape, self.heads\n            q, k, v = map(lambda proj, token: proj(token), zip((self.Q, self.K, self.V), x))\n        else:\n            b, n, d, h = *x.shape, self.heads\n            q, k, v = map(lambda proj: proj(x), (self.Q, self.K, self.V))\n\n        q, k, v = map(lambda t: rearrange(t, \"b n (h d) -> b h n d\", h=h), (q, k, v))\n"}