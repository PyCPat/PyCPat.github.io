{"BEFORE":"        q = q.reshape(b, self.heads, -1, h * w)\n        k = k.reshape(b, -1, h * w)\n        v = v.reshape(b, -1, h * w)\n\n        if context is not None:\n            context = context.reshape(b, c, 1, -1)\n            ck = self.to_k(context).reshape(b, k_dim, -1)\n            cv = self.to_v(context).reshape(b, k_dim, -1)\n","AFTER":"        b, c, h, w, k_dim, heads = *x.shape, self.key_dim, self.heads\n\n        q, k, v = (self.to_q(x), self.to_k(x), self.to_v(x))\n\n        q, k, v = map(lambda t: t.reshape(b, heads, -1, h * w), (q, k, v))\n\n        if context is not None:\n            context = context.reshape(b, c, 1, -1)\n            ck, cv = self.to_k(context), self.to_v(context)\n            ck, cv = map(lambda t: t.reshape(b, heads, k_dim, -1), (ck, cv))\n"}