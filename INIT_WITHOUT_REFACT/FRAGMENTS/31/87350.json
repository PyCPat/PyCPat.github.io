{"BEFORE":"            pd = torch.det(Aup) * torch.det(Adown)\n            out[:,ic] = (btrace(iAup@d2Aup) + btrace(iAdown@d2Adown)) * pd\n","AFTER":"        for ic,(cup,cdown) in enumerate(zip(self.configs[0],self.configs[1])):\n\n            Aup = MO.index_select(1,self.index_up).index_select(2,cup)\n            Adown = MO.index_select(1,self.index_down).index_select(2,cdown)\n            \n            iAup = torch.inverse(Aup)\n            iAdown = torch.inverse(Adown)\n            \n            d2Aup = d2MO.index_select(1,self.index_up).index_select(2,cup)\n            d2Adown = d2MO.index_select(1,self.index_down).index_select(2,cdown)\n            #pd = torch.det(Aup) * torch.det(Adown)\n            out[:,ic] = (btrace(iAup@d2Aup) + btrace(iAdown@d2Adown)) #* pd\n\n            if not return_local_energy:\n                pd = torch.det(Aup) * torch.det(Adown)\n                out[:,ic] *= pd\n\n        return -0.5*out.view(-1,1)\n"}